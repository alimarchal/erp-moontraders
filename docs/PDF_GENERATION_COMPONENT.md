# PDF Generation Component Documentation

This document provides comprehensive instructions on using the reusable PDF generation components in the MoonTrader ERP system.

## Overview

The PDF generation system provides two approaches:
1. **Server-Side PDF Generation** - Using Laravel DomPDF for backend processing
2. **Client-Side PDF Generation** - Using JavaScript (jsPDF) for browser-based generation

Both approaches use reusable components that can be easily integrated into any view.

---

## Components

### 1. Blade Component: `<x-pdf-download-button>`

Location: `resources/views/components/pdf-download-button.blade.php`

A reusable button component for triggering PDF downloads.

#### Props

| Prop | Type | Default | Description |
|------|------|---------|-------------|
| `id` | string | `'pdf-download-btn'` | Button element ID |
| `label` | string | `'Download PDF'` | Button text label |
| `type` | string | `'client'` | `'client'` or `'server'` |
| `route` | string | `null` | Server route (required for server-side) |
| `icon` | boolean | `true` | Show download icon |
| `variant` | string | `'indigo'` | Color: `indigo`, `gray`, `blue`, `green` |
| `size` | string | `'md'` | Size: `sm`, `md`, `lg` |

#### Example Usage

**Server-Side PDF:**
```blade
<x-pdf-download-button 
    type="server" 
    :route="route('vehicles.export.pdf')" 
    label="Export PDF" 
    variant="blue" />
```

**Client-Side PDF:**
```blade
<x-pdf-download-button 
    id="my-pdf-btn" 
    type="client" 
    label="Download PDF" 
    variant="green" />
```

---

### 2. JavaScript Component: `PDFGenerator`

Location: `public/jsandcss/pdf-generator.js`

A reusable JavaScript class for client-side PDF generation with jsPDF.

#### Basic Usage

```javascript
// Include the script
<script src="{{ asset('jsandcss/pdf-generator.js') }}"></script>

// Initialize with configuration
const pdfGen = new PDFGenerator({
    buttonId: 'my-pdf-btn',
    documentTitle: 'My Document',
    fileName: 'my-document.pdf',
    orientation: 'p', // 'p' = portrait, 'l' = landscape
    format: 'a4',
    logoUrl: '{{ asset("icons-images/logo.png") }}',
    appName: '{{ config("app.name") }}',
    debug: true,
    
    // Custom generation function
    generateFn: async function(generator) {
        const { jsPDF } = window.jspdf;
        const doc = new jsPDF('p', 'pt', 'a4');
        
        // Your custom PDF logic here
        
        doc.save(generator.config.fileName);
    }
});
```

#### Configuration Options

| Option | Type | Default | Description |
|--------|------|---------|-------------|
| `buttonId` | string | `'pdf-download-btn'` | ID of trigger button |
| `documentTitle` | string | `'Document'` | PDF document title |
| `fileName` | string | `'document.pdf'` | Output filename |
| `orientation` | string | `'p'` | `'p'` (portrait) or `'l'` (landscape) |
| `format` | string | `'a4'` | Page format |
| `logoUrl` | string | `null` | Logo image URL |
| `logoSize` | object | `{width: 140, height: 50}` | Logo dimensions |
| `appName` | string | `''` | Application name |
| `debug` | boolean | `false` | Enable debug logging |
| `includeQRCode` | boolean | `false` | Load QRCode library |
| `generateFn` | function | `null` | Custom generation function |

#### Built-in Helper Methods

##### `formatDate(date, format)`
Formats dates for display
```javascript
generator.formatDate(new Date(), 'short'); // "04 Nov 2025"
generator.formatDate(new Date(), 'long');  // "04 November 2025, 02:30 PM"
```

##### `addLogo(doc, x, y)`
Adds logo to PDF at specified position
```javascript
await generator.addLogo(doc, 35, 20);
```

##### `drawHeader(doc, title, subtitle)`
Draws a centered header section
```javascript
let y = generator.drawHeader(doc, 'INVOICE', 'Invoice #12345');
```

##### `drawTable(doc, headers, rows, startY, options)`
Draws a formatted table
```javascript
const headers = [
    { label: 'Name', align: 'left' },
    { label: 'Amount', align: 'right' }
];

const rows = [
    ['Product A', '$100.00'],
    ['Product B', '$200.00']
];

y = generator.drawTable(doc, headers, rows, y, {
    margin: 40,
    rowHeight: 25,
    fontSize: 9,
    columnWidths: [300, 200]
});
```

##### `drawFooter(doc, text, pageNumber)`
Draws footer with metadata
```javascript
generator.drawFooter(doc, 'Generated by John Doe', true);
```

---

## Implementation Examples

### Example 1: Simple List Export (Server-Side)

#### Step 1: Create Controller Method

```php
public function exportPdf(Request $request)
{
    $items = YourModel::query()
        ->with('relations')
        ->get();

    $pdf = Pdf::loadView('your-module.pdf', [
        'items' => $items,
        'generatedBy' => auth()->user()->name,
        'generatedAt' => now(),
    ]);

    return $pdf->download('your-export-' . now()->format('Y-m-d') . '.pdf');
}
```

#### Step 2: Create PDF View

```blade
{{-- resources/views/your-module/pdf.blade.php --}}
<!DOCTYPE html>
<html>
<head>
    <title>Your Export</title>
    <style>
        /* Add your styles */
    </style>
</head>
<body>
    <table>
        <thead>
            <tr>
                <th>Column 1</th>
                <th>Column 2</th>
            </tr>
        </thead>
        <tbody>
            @foreach($items as $item)
            <tr>
                <td>{{ $item->field1 }}</td>
                <td>{{ $item->field2 }}</td>
            </tr>
            @endforeach
        </tbody>
    </table>
</body>
</html>
```

#### Step 3: Add Route

```php
Route::get('your-module/export/pdf', [YourController::class, 'exportPdf'])
    ->name('your-module.export.pdf');
```

#### Step 4: Add Button to View

```blade
<x-pdf-download-button 
    type="server" 
    :route="route('your-module.export.pdf')" 
    label="Export PDF" />
```

---

### Example 2: Complex Document (Client-Side)

#### Step 1: Add Button to View

```blade
<x-pdf-download-button 
    id="invoice-pdf-btn" 
    type="client" 
    label="Download Invoice" />
```

#### Step 2: Add Script Section

```blade
@push('scripts')
<script src="{{ asset('jsandcss/pdf-generator.js') }}"></script>
<script>
document.addEventListener('DOMContentLoaded', function() {
    const invoiceData = @json($invoice);
    
    const invoicePdf = new PDFGenerator({
        buttonId: 'invoice-pdf-btn',
        documentTitle: 'Invoice',
        fileName: 'invoice-' + invoiceData.id + '.pdf',
        orientation: 'p',
        format: 'a4',
        logoUrl: '{{ asset("icons-images/logo.png") }}',
        appName: '{{ config("app.name") }}',
        debug: true,
        
        generateFn: async function(generator) {
            const { jsPDF } = window.jspdf;
            const doc = new jsPDF('p', 'pt', 'a4');
            const pageWidth = doc.internal.pageSize.getWidth();
            let y = 20;
            
            // Add logo
            await generator.addLogo(doc, 35, y);
            
            // Header
            y = generator.drawHeader(
                doc, 
                'INVOICE', 
                'Invoice #' + invoiceData.id
            );
            
            // Bill To section
            y += 20;
            doc.setFont('helvetica', 'bold');
            doc.setFontSize(11);
            doc.text('BILL TO:', 40, y);
            
            y += 20;
            doc.setFont('helvetica', 'normal');
            doc.setFontSize(10);
            doc.text('Customer: ' + invoiceData.customer.name, 40, y);
            
            y += 40;
            
            // Items table
            const headers = [
                { label: 'Description', align: 'left' },
                { label: 'Quantity', align: 'center' },
                { label: 'Price', align: 'right' },
                { label: 'Total', align: 'right' }
            ];
            
            const rows = invoiceData.items.map(item => [
                item.description,
                item.quantity.toString(),
                '$' + item.price.toFixed(2),
                '$' + (item.quantity * item.price).toFixed(2)
            ]);
            
            y = generator.drawTable(doc, headers, rows, y, {
                columnWidths: [250, 80, 100, 100]
            });
            
            // Total
            y += 20;
            doc.setFont('helvetica', 'bold');
            doc.setFontSize(12);
            doc.text('TOTAL:', pageWidth - 150, y);
            doc.text('$' + invoiceData.total.toFixed(2), pageWidth - 50, y, { align: 'right' });
            
            // Footer
            generator.drawFooter(doc, 'Thank you for your business!');
            
            // Save
            doc.save(generator.config.fileName);
        }
    });
});
</script>
@endpush
```

---

## Best Practices

### 1. Server-Side PDF (DomPDF)
- **Use for:** Large datasets, server-side processing, scheduled exports
- **Pros:** Handles complex layouts, better for large documents, consistent rendering
- **Cons:** Server resource usage, requires page reload

### 2. Client-Side PDF (jsPDF)
- **Use for:** Quick exports, interactive documents, small to medium datasets
- **Pros:** No server load, instant generation, works offline
- **Cons:** Limited to browser resources, may struggle with very large datasets

### 3. Styling Tips for Server-Side PDFs

```css
/* Use absolute units (px, pt) instead of relative (em, rem) */
font-size: 11px;

/* Inline styles work better than external CSS */
style="color: #333; font-weight: bold;"

/* Use web-safe fonts or include custom fonts */
font-family: 'DejaVu Sans', sans-serif;

/* Avoid complex CSS features (flexbox, grid) */
/* Use tables for layout instead */
```

### 4. Performance Tips

```javascript
// For large datasets, paginate client-side generation
if (items.length > 100) {
    // Process in chunks
    const chunkSize = 50;
    for (let i = 0; i < items.length; i += chunkSize) {
        const chunk = items.slice(i, i + chunkSize);
        // Process chunk
    }
}

// Add progress indicators for long operations
btn.innerHTML = 'Processing ' + currentPage + ' of ' + totalPages + '...';
```

### 5. Error Handling

```javascript
generateFn: async function(generator) {
    try {
        // PDF generation code
        doc.save(generator.config.fileName);
    } catch (error) {
        console.error('PDF Generation Error:', error);
        alert('Failed to generate PDF: ' + error.message);
        throw error; // Re-throw to be caught by PDFGenerator
    }
}
```

---

## Troubleshooting

### Issue: Logo not showing in PDF

**Solution:** Ensure logo path is correct and accessible:
```javascript
logoUrl: '{{ asset("icons-images/logo.png") }}'
```

### Issue: Table overflowing page

**Solution:** Adjust column widths or use landscape orientation:
```javascript
orientation: 'l',
columnWidths: [100, 150, 200, 150] // Adjust to fit
```

### Issue: Fonts not rendering correctly

**Solution:** Use web-safe fonts or specify fallbacks:
```css
font-family: 'DejaVu Sans', 'Arial', sans-serif;
```

### Issue: Memory errors with large datasets

**Solution:** Implement pagination or use server-side generation:
```php
// Server-side handles large datasets better
$items = Model::chunk(1000, function($chunk) {
    // Process chunk
});
```

---

## Advanced Features

### Adding QR Codes

```javascript
const pdfGen = new PDFGenerator({
    includeQRCode: true, // Load QRCode library
    generateFn: async function(generator) {
        // Generate QR code
        const qrContainer = document.createElement('div');
        qrContainer.style.position = 'absolute';
        qrContainer.style.left = '-9999px';
        document.body.appendChild(qrContainer);
        
        const qr = new QRCode(qrContainer, {
            text: 'Your data here',
            width: 150,
            height: 150
        });
        
        await new Promise(resolve => setTimeout(resolve, 100));
        
        const qrImg = qrContainer.querySelector('img');
        if (qrImg) {
            doc.addImage(qrImg.src, 'PNG', 40, y, 120, 120);
        }
        
        document.body.removeChild(qrContainer);
    }
});
```

### Multi-Page Documents

```javascript
generateFn: async function(generator) {
    const pageHeight = doc.internal.pageSize.getHeight();
    let y = 60;
    
    items.forEach((item, index) => {
        // Check if need new page
        if (y > pageHeight - 100) {
            doc.addPage();
            y = 60;
        }
        
        // Draw content
        doc.text(item.name, 40, y);
        y += 20;
    });
}
```

---

## Reference: Complete Vehicle Example

See the implementation in:
- Controller: `app/Http/Controllers/VehicleController.php` (method: `exportPdf`)
- View: `resources/views/vehicles/index.blade.php`
- PDF Template: `resources/views/vehicles/pdf.blade.php`

This provides a complete working example of both server-side and client-side PDF generation.

---

## Summary

The PDF generation components provide:
- ✅ Reusable Blade button component
- ✅ Flexible JavaScript PDF generator class
- ✅ Server-side and client-side options
- ✅ Helper methods for common operations
- ✅ Easy integration into any view
- ✅ Customizable styling and layouts

Use server-side for heavy documents and client-side for quick, interactive exports.
